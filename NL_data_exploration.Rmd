---
title: "NL project data exploration"
author: "Susanne Kortsch"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Data exploration

Analyses in this document explore the data set generated by the Netlogo model

**Input**:  

- "../Data_output/df_total_con_prob_visits.csv": this data file contains the interaction-wise results per simulation (n=1000).

Our input variables are:
- seed percentage (varies between 0.00001 and 1)
- niche and niche preferences (vary between 3.50209e-05 and 1). Graphs cannot be unconnected which means networks always consist of 8 pollinators and 6 plants 
- body mass (vary between 1 and 8). These values are taken from an empirical data set
- plant density can vary between 0.1 and 0.9. 
- the niche and niche preferences result in network structure with different connectance and nestedness etc.

**Output**:  

Our response (dependent) variables are:
- Number_visits=visitation rate
- Cons=consecutive visits
- Pvis=expected pollination visits based on the geometric decay assumption (with a 30% decline in pollination probability of donor pollen per visit in a visitation sequence)

Weighted network metrics were calculated based on the different visitation measures. 


### Brief summary of the prelimnary findings 
- the analyses at the network level show not obvious trend between seed percentage (habitat heterogenity) and visits.
- BUT network structure such as connectance and nestedness seem to influence the mean visits. In Figures 2 and 3 the visits were calculated as the mean visits to the 6 plants in the networks, as a function of network connectance and nestedness

- summary analyses at the interaction level show some positive relationships between plant preferences and visits. Highly preferred plants are on average more visited. There is also a positive relationship between plant density and visits. Plants in plant dense habitats lead on average to  more visits.
Body size has also an effect on visits. Smaller body size lead, on average, to less visits for visitation rate and expected pollination visits (pvis). However, for consecutive visits this pattern is opposite and smaller body sizes lead to more consecutive visits on average.



```{r data setup, eval = FALSE, echo=FALSE,include=FALSE}
setwd("C:/LocalData/susakort/pollinatorsNL-main_18/R_scripts")

vis_data<-read.csv("../Data_output/df_total_con_prob_visits.csv", header=TRUE)

```


```{r load, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#load packages
library("tidyverse") #Needed to easily summarise and analyse data 
library("lubridate") #Getting R to agree that your data contains the dates and times
library("bipartite")
library("ggpubr")   #arrange plot
library("sjPlot") #visualisating results
library("sjmisc")
library("moments")
#library("dplyr")

```

### Summary Plots at the network level
- First we look at the variability of pollination visits as a function of seed percentage and input network structure (e.g., connectance and nestedness) at the network or model level

#Do visits vary with habitat heterogeniety?

```{r plot1, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
vis_data<-read.csv("../Data_output/df_total_con_prob_visits.csv", header=TRUE)
#code to run the analyses
df.vis.sum<-vis_data %>% group_by(run, seed_percent, plant_species) %>% summarise(number_visits = sum(number_visits), 
                                                                                  cons= sum(cons), pvis=sum(pvis), connectance=mean(conn), nestedness=mean(nest))  
df.vis<-df.vis.sum %>% group_by(run, seed_percent) %>% summarise(number_visits = mean(number_visits), cons= mean(cons), pvis=mean(pvis), 
                                                                 connectance=mean(connectance), nestedness=mean(nestedness))  
# set up cut-off values 
breaks <- c( 0.00005, 0.0001, 0.0005, 0.001, 0.005, 0.01, 0.05, 0.00, 0.2, 0.4,0.6,0.8, 1)
# specify interval/bin labels
tags <- c( "[0.00005-0.0001)", "[0.0001-0.0005)",  "[0.0005-0.001)", "[0.001-0.005)", "[0.005-0.01)", 
           "[0.01-0.05)","[0.05-0.00)", "[0.0-0.2)", "[0.2-0.4)","[0.4-0.6)","[0.6-0.8)", "[0.8-1)")
# bucketing values into bins
df.vis$bins_seed <- cut(df.vis$seed_percent, breaks=breaks, include.lowest=TRUE, right=FALSE, labels=tags)

#summary(df.vis$bins_seed )
bin.seed1<-ggplot(df.vis, aes(x = factor(bins_seed), y = number_visits)) + xlab("seed percent") + 
  ylab("visits") + theme_light() + geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5)+
  stat_summary(geom = "point",fun = "median",col = "black",size = 4,shape = 21,fill = "red") + guides(x =  guide_axis(angle = 90)) 

bin.seed2<-ggplot(df.vis, aes(x = factor(bins_seed), y = cons)) + xlab("seed percent") + 
  ylab("consecutive visits") +  theme_light() + geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5)+
  stat_summary(geom = "point",fun = "median",col = "black",size = 4,shape = 21,fill = "red") + guides(x =  guide_axis(angle = 90)) 

bin.seed3<-ggplot(df.vis, aes(x = factor(bins_seed), y = pvis)) + xlab("seed percent") + 
  ylab("geometric decay visits") + theme_light() +    geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5)+
  stat_summary(geom = "point",fun = "median",col = "black",size = 4,shape = 21,fill = "red") + guides(x =  guide_axis(angle = 90)) 

ggarrange(bin.seed1, bin.seed2, bin.seed3 ,  labels = c("A", "B", "C"), ncol = 3)

```


**Figure 1:**Relationship between visitation rate, consecutive visits, pollination probability visits and seed percentage. The Y axis shows the expected visits of the binned seed percentage (x axis) values, and the red dot indicated the median of those.

#Conclusion: there is no obvious trend between the different measures of pollination visits and habitat heterogenity. This is different from what I expected. I expected number of visits to increase with habitat heterogenity and consecutive visits to decrease, for pollination visits based on the geometric decay assumption I expected the slope of the relationship to vary with the coeffcient of decrease in pollination porbability (here the coeffcient is 0.3).


### In the follwoing analsyis seed_percent was sepearted from plant densities calculating excess kurtosis (peakedness) of the distribution of plant densities, per run (simulation).

Excess kurtosis is defined as kurtosis - 3 
"The kurtosis for a standard normal distribution is three. Minus 3 is used so that the standard normal distribution has a kurtosis of zero."
#"positive kurtosis indicates a "heavy-tailed" distribution and negative kurtosis indicates a "light tailed" distribution"

Examples from (https://en.wikipedia.org/wiki/Kurtosis):
    * D: Laplace distribution, also known as the double exponential distribution, red curve (two straight lines in the log-scale plot), excess kurtosis= 3
    * N: normal distribution, black curve (inverted parabola in the log-scale plot), excess kurtosis = 0
    * U: uniform distribution, magenta curve (shown for clarity as a rectangle in both images), excess kurtosis = - 1.2.

```{r plot1b, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
vis_data<-read.csv("../Data_output/df_total_con_prob_visits.csv", header=TRUE)

df.vis.skew <- vis_data %>% group_by(run, seed_percent) %>% summarize( skewness = skewness(pl.dens), kurtosis=kurtosis(pl.dens)-3)
#example of kurtosis in plant density above 0
#df.vis.skew %>% filter(kurtosis>0)
#vis_data %>% filter(run==1536062925  ) %>% group_by( plant_species,seed_percent) %>% ggplot(aes(plant_species,pl.dens)) +geom_point()
#vis_data %>% filter(run==1144125424 ) %>% group_by( plant_species,seed_percent) %>% ggplot(aes(plant_species,pl.dens)) + geom_point() #example of kurtosis in 
df.vis.skew %>% filter(kurtosis<0)
#vis_data %>% filter(run==1125066572 ) %>% group_by( plant_species,seed_percent) %>% ggplot(aes(plant_species,pl.dens)) + geom_point()
#
#vis_data %>% filter(run==1130435207 ) %>% group_by( plant_species,seed_percent) %>% ggplot(aes(plant_species,pl.dens)) + geom_point() 

#code to run the analyses
df.vis.sum<-vis_data %>% group_by(run, seed_percent, plant_species) %>% summarise(number_visits = sum(number_visits), 
                                                                                  cons= sum(cons), pvis=sum(pvis), connectance=mean(conn), nestedness=mean(nest))  
df.vis<-df.vis.sum %>% group_by(run, seed_percent) %>% summarise(number_visits = mean(number_visits), cons= mean(cons), pvis=mean(pvis), 
                                                                 connectance=mean(connectance), nestedness=mean(nestedness))  %>% inner_join(df.vis.skew)

# Check relationship 

ggplot(df.vis, aes(log(seed_percent),kurtosis)) + geom_point()
ggplot(df.vis, aes(seed_percent)) + geom_histogram() 
ggplot(df.vis, aes(log(seed_percent))) + geom_histogram() 


# set up cut-off values 
breaks <- c( 0,0.00005, 0.0001, 0.0005, 0.001, 0.005, 0.01, 0.05, 0.1, 0.2, 0.4,0.6,0.8, 1)
# specify interval/bin labels
tags <- c( "[0 - 0.00005)","[0.00005-0.0001)", "[0.0001-0.0005)",  "[0.0005-0.001)", "[0.001-0.005)", "[0.005-0.01)", 
           "[0.01-0.05)","[0.05-0.00)", "[0.0-0.2)", "[0.2-0.4)","[0.4-0.6)","[0.6-0.8)", "[0.8-1)")
# bucketing values into bins
df.vis$bins_seed <- cut(df.vis$seed_percent, breaks=breaks, include.lowest=TRUE, right=FALSE, labels=tags)

df.vis %>% group_by(bins_seed) %>% summarise(n=n())

#
ggplot(df.vis, aes(kurtosis)) + geom_histogram() 

range(df.vis$kurtosis)
bs1 <- df.vis %>% mutate(cut_skew = cut(kurtosis,breaks=c(-2,-0.5,0,1,2,6))) %>% ggplot( aes(x = factor(bins_seed), y = number_visits)) + xlab("seed percent") + 
  ylab("visits") + theme_light() + geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5)+
  stat_summary(geom = "point",fun = "median",col = "black",size = 4,shape = 21,fill = "red") + guides(x =  guide_axis(angle = 90)) + facet_wrap( ~cut_skew)

bs2 <- df.vis %>% mutate(cut_skew = cut(kurtosis,breaks=c(-2,-0.5,0,1,2,6))) %>% ggplot( aes(x = factor(bins_seed), y = cons)) + xlab("seed percent") + 
  ylab("Consecutive visits") + theme_light() + geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5)+
  stat_summary(geom = "point",fun = "median",col = "black",size = 4,shape = 21,fill = "red") + guides(x =  guide_axis(angle = 90)) + facet_wrap( ~cut_skew)


bs3 <- df.vis %>% mutate(cut_skew = cut(kurtosis,breaks=c(-2,-0.5,0,1,2,6))) %>% ggplot( aes(x = factor(bins_seed), y = pvis)) + xlab("seed percent") + 
  ylab("geometric decay visits") + theme_light() + geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5)+
  stat_summary(geom = "point",fun = "median",col = "black",size = 4,shape = 21,fill = "red") + guides(x =  guide_axis(angle = 90)) + facet_wrap( ~cut_skew)

ggarrange(bs1, bs2, bs3 ,  labels = c("A", "B", "C"), ncol = 3)

```


* Negative values of excess Kurtosis correspond to uniform distribution, we have few points for positive excess kurtosis but for values > 1 there seem to be different patterns.



#Do visits vary with input network structure? how connected and nested the networks are?
```{r plot2, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
#Plot visits as a function of input connectance 

conn1<-ggplot(df.vis, aes(x= connectance , y = number_visits,)) + xlab("connectance") + ylab("visitation rate") + geom_point(alpha=0.5) +
  geom_smooth(color="red", se=TRUE) +theme_light()  

conn2<-ggplot(df.vis, aes(x= connectance , y = cons,)) + xlab("connectance") + ylab("consecutive visits") + geom_point(alpha=0.5) +
  geom_smooth(color="red", se=TRUE) +theme_light()  

conn3<-ggplot(df.vis, aes(x= connectance , y = pvis,)) + xlab("connectance") + ylab("geometric decay 0.3") + geom_point(alpha=0.5) +
  geom_smooth(color="red", se=TRUE) +theme_light()  

ggarrange(conn1, conn2, conn3 ,  labels = c("A", "B", "C"), ncol = 3)

```

**Figure 2:**Relationship between visitation rate, consecutive visits, pollination probability visits and input connectance. 

#conclusion: Visits vary in a non-linear fashion with connectance. Visitation rate is positively correlated with connectance. Connsecutive visits decrease with connectance, whereas geometric decay visits increase for low level of connectance for then to saturate around a connectance of 0.6 

```{r plot3, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
#Plot visits as a function of input nestedness 
nest1<-ggplot(df.vis, aes(x= nestedness , y = number_visits,)) + xlab("nestedness") + ylab("visitation rate") + geom_point(alpha=0.5) +
  geom_smooth(color="red", se=TRUE) +theme_light()  

nest2<-ggplot(df.vis, aes(x= nestedness , y = cons,)) + xlab("nestedness") + ylab("consecutive visits") + geom_point(alpha=0.5) +
  geom_smooth(color="red", se=TRUE) +theme_light()  

nest3<-ggplot(df.vis, aes(x= nestedness , y = pvis,)) + xlab("nestedness") + ylab("geometric decay 0.3") + geom_point(alpha=0.5) +
  geom_smooth(color="red", se=TRUE) +theme_light()  

ggarrange(nest1, nest2, nest3 ,  labels = c("A", "B", "C"), ncol = 3)

```

**Figure 3:**Relationship between visitation rate, consecutive visits, pollination probability visits and input nestedness

#conclusion: The relationshp between visitation rate, consecutive visits, pollination probability visitsn and nestedness are non-linear, and clearest for visitation rate. There is a positive realtionship between nestedness and visitation rate. the more nested, the more visits apart from non-nested networks (which are probably fully connected networks), these networks result in high number of visits


#how is connectance and nestedness correlated?
```{r plot4, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
nest.conn<-ggplot(df.vis, aes(x = connectance, y = nestedness)) + geom_point(alpha=0.5) + theme_light()+ geom_smooth(col="red")
nest.conn
```

**Figure 4:**Relationship between connectance and nestedness in the binary input networks

#conclusion: there is a positive relationship for connectance and nestedness. the more nested, the more connected apart from fully connected networks which are not nested


#how are plant mean plant preferences and nestedness related?
```{r plot5, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
df.vis.sum<-vis_data %>% group_by(run, seed_percent, plant_species, pl.dens) %>% 
  summarise(pl.pref=mean(plant.pref), number_visits = sum(number_visits), cons= sum(cons), pvis=sum(pvis), connectance=mean(conn), nestedness= mean(nest))  
df.vis<-df.vis.sum %>% group_by(run, seed_percent) %>% summarise(pl.pref=mean(pl.pref), pl.dens=mean(pl.dens), 
  number_visits = median(number_visits), cons= median(cons), pvis=median(pvis), connectance=mean(connectance), nestedness=mean(nestedness))  

ggplot(df.vis, aes(x= pl.pref , y = nestedness,)) + xlab("mean pl.prefs") + ylab("nestedness") + geom_point() +
  geom_smooth(color="red", se=TRUE) +theme_light()  +stat_cor() 
```

**Figure 5:**Relationship between nestedness and mean plant preferences 

#conclusion: more nested networks have an average lower plant preferences as these contain more generalist pollinator species


```{r plot6, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
ggplot(df.vis, aes(x= pl.pref , y = connectance,)) + xlab("mean pl.prefs") + ylab("connectance") + geom_point() +
  geom_smooth(color="red", se=TRUE) +theme_light()  +stat_cor() 
```

**Figure 6:**Relationship between connectance and mean plant preferences 

#conclusion:mean lower preferences in highly connected food webs


### Glm's with interaction terms

#explanatory variables may interact. For example, ss the effect of connectance different in nested vs. non-nested networks? 

```{r plot17, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}

df.vis.sum<-vis_data %>% group_by(run, seed_percent, plant_species, pl.dens) %>%  summarise(pl.pref=mean(plant.pref), 
number_visits = sum(number_visits), cons= sum(cons), pvis=sum(pvis), connectance=mean(conn), nestedness= mean(nest))  

df.vis<-df.vis.sum %>% group_by(run, seed_percent) %>% summarise(pl.pref=mean(pl.pref), pl.dens=mean(pl.dens), 
  number_visits = median(number_visits), cons= median(cons), 
  pvis=median(pvis), connectance=mean(connectance), nestedness=mean(nestedness))  


glm.conn_nest1<-glm(round(number_visits) ~ connectance*nestedness, data=df.vis, family=poisson())
summary(glm.conn_nest1)
plot_glm.conn_nest1<-plot_model(glm.conn_nest1, type="pred", terms = c("connectance", "nestedness[0, 30, 50, 70]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .8, legend.title.size = 1) +theme(legend.key=element_blank()) + 
  guides(color=guide_legend(override.aes=list(fill=NA)))

glm.conn_nest2<-glm(round(cons) ~ connectance*nestedness, data=df.vis, family=poisson())
summary(glm.conn_nest2)
plot_glm.conn_nest2<-plot_model(glm.conn_nest2, type="pred", terms = c("connectance", "nestedness [0, 30, 50, 70]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .8, legend.title.size = 1) +theme(legend.key=element_blank()) + 
  guides(color=guide_legend(override.aes=list(fill=NA)))

glm.conn_nest3<-glm(round(pvis) ~ connectance*nestedness, data=df.vis, family=poisson())
summary(glm.conn_nest3)
plot_glm.conn_nest3<-plot_model(glm.conn_nest3, type="pred", terms = c("connectance", "nestedness [0, 30, 50, 70]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .8, legend.title.size = 1) +theme(legend.key=element_blank()) + 
  guides(color=guide_legend(override.aes=list(fill=NA)))

#plot_model(glm.mod, type = "int")#type = "int" will automatically plot the interaction terms, however, using mdrt.values = "minmax"
#lm.mod<-lm(round(pvis) ~ connectance*nestedness, data=df.vis, family=poisson())
#summary(lm.mod)

#plot_model(lm.mod, type="pred", terms = c("connectance", "nestedness [30, 50, 70]"))
#plot_model(lm.mod, type = "int")#type = "int" will automatically plot the interaction terms, however, using mdrt.values = "minmax"
#poor model fit (239879-231798)/239879*100

ggarrange(plot_glm.conn_nest1, plot_glm.conn_nest2, plot_glm.conn_nest3,  labels = c("A", "B", "C"), ncol = 3)

```


 **Figure 7:**Relationship between mean visits and connectance for different plant nestedness levels

```{r plot8,echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}

glm.mod.conn1<-glm(round(number_visits) ~ connectance*pl.pref, data=df.vis, family=poisson())
summary(glm.mod.conn1)
plot_glm.mod.conn1<-plot_model(glm.mod.conn1, type="pred", terms = c("connectance", "pl.pref[0.15, 0.30, 0.45]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .8, legend.title.size = 1) +theme(legend.key=element_blank()) +       guides(color=guide_legend(override.aes=list(fill=NA)))

glm.mod.conn2<-glm(round(cons) ~ connectance*pl.pref, data=df.vis, family=poisson())
summary(glm.mod.conn2)
plot_glm.mod.conn2<-plot_model(glm.mod.conn2, type="pred", terms = c("connectance", "pl.pref[0.15, 0.30, 0.45]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .8, legend.title.size = 1) +theme(legend.key=element_blank()) + guides(color=guide_legend(override.aes=list(fill=NA)))

glm.mod.conn3<-glm(round(pvis) ~ connectance*pl.pref, data=df.vis, family=poisson())
summary(glm.mod.conn3)
plot_glm.mod.conn3<-plot_model(glm.mod.conn3, type="pred", terms = c("connectance", "pl.pref[0.15, 0.30, 0.45]"))+ 
 set_theme(base=theme_light(), legend.pos = "top", legend.size = .8, legend.title.size = 1) +theme(legend.key=element_blank()) +  guides(color=guide_legend(override.aes=list(fill=NA)))

ggarrange(plot_glm.mod.conn1, plot_glm.mod.conn2, plot_glm.mod.conn3 ,  labels = c("A", "B", "C"), ncol = 3)

```

 **Figure 8:**Relationship between mean visits and connectance for different plant preference levels

```{r plot9,echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}

df.vis.sum<-vis_data %>% group_by(run, seed_percent, plant_species, pl.dens) %>%  summarise(pl.pref=mean(plant.pref), 
number_visits = sum(number_visits), cons= sum(cons), pvis=sum(pvis), connectance=mean(conn), nestedness= mean(nest))  

df.vis<-df.vis.sum %>% group_by(run, seed_percent) %>% summarise(pl.pref=mean(pl.pref), pl.dens=mean(pl.dens), 
  number_visits = median(number_visits), cons= median(cons), 
  pvis=median(pvis), connectance=mean(connectance), nestedness=mean(nestedness))  


glm.mod.nest1<-glm(round(number_visits) ~ nestedness*pl.pref, data=df.vis, family=poisson())
summary(glm.mod.nest1)
plot_glm.mod.nest1<-plot_model(glm.mod.nest1, type="pred", terms = c("nestedness", "pl.pref[0.15, 0.30, 0.45]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .6, legend.title.size = 0.8) +theme(legend.key=element_blank()) +       guides(color=guide_legend(override.aes=list(fill=NA)))

glm.mod.nest2<-glm(round(cons) ~ nestedness*pl.pref, data=df.vis, family=poisson())
summary(glm.mod.nest2)
plot_glm.mod.nest2<-plot_model(glm.mod.nest2, type="pred", terms = c("nestedness", "pl.pref[0.15, 0.30, 0.45]"))+
  set_theme(base=theme_light(), legend.pos = "top", legend.size = .6, legend.title.size = 0.8) +theme(legend.key=element_blank()) + guides(color=guide_legend(override.aes=list(fill=NA)))

glm.mod.nest3<-glm(round(pvis) ~ nestedness*pl.pref, data=df.vis, family=poisson())
summary(glm.mod.nest3)
plot_glm.mod.nest3<-plot_model(glm.mod.nest3, type="pred", terms = c("nestedness", "pl.pref[0.15, 0.30, 0.45]"))+ 
 set_theme(base=theme_light(), legend.pos = "top", legend.size = .6, legend.title.size = 0.8) +theme(legend.key=element_blank()) +  guides(color=guide_legend(override.aes=list(fill=NA)))

ggarrange(plot_glm.mod.nest1, plot_glm.mod.nest2, plot_glm.mod.nest3 ,  labels = c("A", "B", "C"), ncol = 3)

```

 **Figure 9:**Relationship between mean visits and nestedness for different plant preference levels


### Summary Plots at the interaction level

#If we want to look at the effect of sociality (effect of nest vs. non-nesting) and body mass, we need to look at the data at the interaction level, and not network level.
#First, we can look at the relationship between plant prefernces and plant density on visits

```{r plot10, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
vis_data<-read.csv("../Data_output/df_total_con_prob_visits.csv", header=TRUE)
vis_data$bins_prefs<- cut(vis_data$plant.pref, breaks=10, dig.lab=2)
pref1<-ggplot(vis_data, aes(x = factor(bins_prefs), y = number_visits)) + xlab("plant.prefs bins") + 
  ylab("mean visits") + stat_summary(fun = mean, geom = "point", size = 2) +theme_light() + guides(x =  guide_axis(angle = 90))
pref2<-ggplot(vis_data, aes(x = factor(bins_prefs), y = cons)) + xlab("plant.prefs bins") + ylab("mean con") + 
  stat_summary(fun = mean, geom = "point", size = 2)+theme_light() + guides(x =  guide_axis(angle = 90))
pref3<-ggplot(vis_data, aes(x = factor(bins_prefs), y = pvis)) + xlab("plant.prefs bins") + ylab("mean pvis")+ 
  stat_summary(fun = mean, geom = "point", size = 2)+theme_light() + guides(x =  guide_axis(angle = 90))
ggarrange(pref1, pref2, pref3 ,  labels = c("A", "B", "C"), ncol = 3)
```

**Figure 10:**Relationship between pollinator plant preferences binned and mean visitation estimates

#conclusion: On average there is a positive relationship between plant preferences and visits. the more preferred plants are, the more visits

```{r plot11, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
vis_data$bins_pldens<- cut(vis_data$pl.dens, breaks=10, dig.lab=2)
dens1<-ggplot(vis_data, aes(x = factor(bins_pldens), y = number_visits)) + xlab("plant.dens bins") + 
  ylab("mean visits") + stat_summary(fun = mean, geom = "point", size = 2) +theme_light() + guides(x =  guide_axis(angle = 90))
dens2<-ggplot(vis_data, aes(x = factor(bins_pldens), y = cons)) + xlab("plant.dens bins") + ylab("mean con") + 
  stat_summary(fun = mean, geom = "point", size = 2)+theme_light() + guides(x =  guide_axis(angle = 90))
dens3<-ggplot(vis_data, aes(x = factor(bins_pldens), y = pvis)) + xlab("plant.dens bins") + ylab("mean pvis")+ 
  stat_summary(fun = mean, geom = "point", size = 2)+theme_light() + guides(x =  guide_axis(angle = 90))
ggarrange(dens1, dens2, dens3 ,  labels = c("A", "B", "C"), ncol = 3)
```

**Figure 11:**Relationship between plant densities binned and mean visitation estimates

#conclusion: On average there is a positive relationship between plant plant desnity and visits. the more plant dense a habitat is, the more visits

```{r plot12, echo=FALSE, fig.height=4, fig.width=7, fig.align = 'center'}
vis_data$bins_bm<- cut(vis_data$pol.bm, breaks=10, dig.lab=2)
bs1<-ggplot(vis_data, aes(x = factor(bins_bm), y = number_visits)) + xlab("bodysize bins") + ylab("mean visits") +
  stat_summary(fun = mean, geom = "point", size = 3) +theme_light() + guides(x =  guide_axis(angle = 90))
bs2<-ggplot(vis_data, aes(x = factor(bins_bm), y = cons)) + xlab("bodysize bins") + ylab("mean cons") + 
  stat_summary(fun = mean, geom = "point", size = 3)+theme_light() + guides(x =  guide_axis(angle = 90))
bs3<-ggplot(vis_data, aes(x = factor(bins_bm), y = pvis)) + xlab("bodysize bins") + ylab("mean pvis") + 
  stat_summary(fun = mean, geom = "point", size = 3)+theme_light() + guides(x =  guide_axis(angle = 90))
ggarrange(bs1, bs2, bs3 ,  labels = c("A", "B", "C"), ncol = 3)
```

**Figure 12:**Relationship between mean visits and body size binned. 


